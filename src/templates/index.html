<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Predictor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media (prefers-reduced-motion: reduce) {
            .float-in,
            .fade-out {
                animation: none !important;
            }
        }

        @keyframes floatIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(10px);
            }
        }

        .float-in {
            animation: floatIn 500ms ease-out both;
        }

        .fade-out {
            animation: fadeOut 220ms ease-in both;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        ink: '#0F172A',
                        mist: '#F8FAFC',
                        stone: '#E7E5E4',
                        sage: '#2F6F62',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-b from-mist to-stone text-ink antialiased">

    <main class="min-h-screen flex items-center justify-center px-6 py-12">
        <div class="w-full max-w-xl">
            <div class="mb-8 text-center">
                <p class="text-xs tracking-[0.28em] uppercase text-slate-500">Salary Estimator</p>
                <h1 class="mt-3 text-3xl sm:text-4xl font-semibold tracking-tight text-slate-900">
                    Simple salary predictions
                </h1>
                <p class="mt-3 text-sm sm:text-base text-slate-600">
                    Enter your experience. Get an estimate.
                </p>
            </div>

            <section class="float-in rounded-3xl bg-white/70 backdrop-blur shadow-[0_10px_30px_rgba(2,6,23,0.08)] border border-white/60">
                <div class="p-7 sm:p-10">
                    <div class="grid gap-6">
                        <div>
                            <label for="experience" class="block text-sm font-medium text-slate-700">Years of experience</label>
                            <div class="mt-2 flex items-center gap-3">
                                <input
                                    type="number"
                                    step="0.1"
                                    id="experience"
                                    placeholder="e.g. 3.5"
                                    inputmode="decimal"
                                    class="w-full rounded-2xl border border-slate-200 bg-white/80 px-4 py-3 text-slate-900 placeholder:text-slate-400 shadow-sm focus:outline-none focus:ring-4 focus:ring-slate-200 focus:border-slate-300"
                                />
                                <button
                                    id="predictBtn"
                                    onclick="predictSalary()"
                                    class="shrink-0 rounded-2xl bg-sage px-5 py-3 text-sm font-medium text-white shadow-sm hover:opacity-95 focus:outline-none focus:ring-4 focus:ring-emerald-100 active:translate-y-[1px]"
                                >
                                    Predict
                                </button>
                            </div>
                            <p class="mt-2 text-xs text-slate-500">Tip: decimals are allowed (e.g. 2.5).</p>
                        </div>

                        <div id="notice" class="hidden rounded-2xl border border-slate-200 bg-white/70 p-4" role="status" aria-live="polite">
                            <div class="flex items-start gap-3">
                                <div id="noticeDot" class="mt-1 h-2.5 w-2.5 rounded-full bg-slate-300"></div>
                                <div class="min-w-0">
                                    <p id="noticeTitle" class="text-sm font-medium text-slate-800">Notice</p>
                                    <p id="noticeText" class="mt-1 text-sm text-slate-600"></p>
                                </div>
                                <button
                                    type="button"
                                    onclick="hideNotice()"
                                    class="ml-auto rounded-xl px-2 py-1 text-xs text-slate-500 hover:text-slate-800"
                                    aria-label="Dismiss notice"
                                >
                                    Dismiss
                                </button>
                            </div>
                        </div>

                        <div id="result" class="hidden rounded-2xl border border-slate-200 bg-white/70 p-6">
                            <div class="flex items-start justify-between gap-4">
                                <div>
                                    <p class="text-xs tracking-[0.22em] uppercase text-slate-500">Estimated salary</p>
                                    <h2 id="salaryText" class="mt-2 text-3xl sm:text-4xl font-semibold text-slate-900">LKR 0</h2>
                                    <p id="statusText" class="mt-2 text-sm text-slate-600"></p>
                                </div>
                                <div class="h-10 w-10 rounded-full bg-emerald-50 border border-emerald-100 flex items-center justify-center">
                                    <span class="text-emerald-700 text-sm">AI</span>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between gap-4 pt-1">
                            <p class="text-xs text-slate-500">Powered by Linear Regression</p>
                            <a class="text-xs text-slate-600 hover:text-slate-900" href="/health" target="_blank" rel="noreferrer">Health</a>
                        </div>
                    </div>
                </div>
            </section>

            <p class="mt-8 text-center text-xs text-slate-500">
                For demo purposes only. Train the model first if needed.
            </p>
        </div>
    </main>

    <script>
        function restartAnimation(element, className) {
            if (!element) return;
            element.classList.remove(className);
            // Force reflow so animation restarts reliably
            void element.offsetWidth;
            element.classList.add(className);
        }

        function showNotice(variant, message, title) {
            const notice = document.getElementById('notice');
            const noticeDot = document.getElementById('noticeDot');
            const noticeTitle = document.getElementById('noticeTitle');
            const noticeText = document.getElementById('noticeText');

            if (!notice || !noticeDot || !noticeTitle || !noticeText) return;

            // Reset variant styles
            notice.classList.remove(
                'border-rose-200',
                'bg-rose-50/70',
                'border-emerald-200',
                'bg-emerald-50/70',
                'border-amber-200',
                'bg-amber-50/70'
            );
            noticeDot.classList.remove('bg-rose-400', 'bg-emerald-400', 'bg-amber-400', 'bg-slate-300');

            if (variant === 'error') {
                notice.classList.add('border-rose-200', 'bg-rose-50/70');
                noticeDot.classList.add('bg-rose-400');
                noticeTitle.innerText = title || 'Something went wrong';
            } else if (variant === 'success') {
                notice.classList.add('border-emerald-200', 'bg-emerald-50/70');
                noticeDot.classList.add('bg-emerald-400');
                noticeTitle.innerText = title || 'All set';
            } else {
                notice.classList.add('border-amber-200', 'bg-amber-50/70');
                noticeDot.classList.add('bg-amber-400');
                noticeTitle.innerText = title || 'Just a note';
            }

            noticeText.innerText = message;
            notice.classList.remove('hidden');
            notice.classList.remove('fade-out');
            restartAnimation(notice, 'float-in');
        }

        function hideNotice() {
            const notice = document.getElementById('notice');
            if (!notice || notice.classList.contains('hidden')) return;
            notice.classList.remove('float-in');
            restartAnimation(notice, 'fade-out');
            window.setTimeout(() => {
                notice.classList.add('hidden');
                notice.classList.remove('fade-out');
            }, 220);
        }

        async function predictSalary() {
            const experience = document.getElementById('experience').value;
            const resultDiv = document.getElementById('result');
            const salaryText = document.getElementById('salaryText');
            const statusText = document.getElementById('statusText');
            const predictBtn = document.getElementById('predictBtn');

            if (!experience) {
                showNotice('info', 'Please enter your years of experience to continue.', 'Input needed');
                return;
            }

            hideNotice();

            // Show result panel + loading state
            resultDiv.classList.remove('hidden');
            resultDiv.classList.remove('fade-out');
            restartAnimation(resultDiv, 'float-in');
            salaryText.innerText = "Calculatingâ€¦";
            salaryText.classList.add('animate-pulse');
            if (statusText) statusText.innerText = "One moment.";
            if (predictBtn) {
                predictBtn.disabled = true;
                predictBtn.classList.add('opacity-70', 'cursor-not-allowed');
            }

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ experience: experience })
                });

                const data = await response.json();

                if (data.error) {
                    salaryText.innerText = "Error";
                    salaryText.classList.remove('animate-pulse');
                    if (statusText) statusText.innerText = "Please check the server response.";
                    showNotice('error', data.error, 'Prediction failed');
                } else {
                    // Format number nicely
                    salaryText.innerText = "LKR " + data.predicted_salary.toLocaleString();
                    salaryText.classList.remove('animate-pulse');
                    if (statusText) statusText.innerText = "Estimate generated.";
                    hideNotice();
                }
            } catch (error) {
                console.error('Error:', error);
                salaryText.innerText = "API Error";
                salaryText.classList.remove('animate-pulse');
                if (statusText) statusText.innerText = "Unable to reach the API.";
                showNotice('error', 'Unable to reach the API. Is the server running?', 'Connection issue');
            } finally {
                if (predictBtn) {
                    predictBtn.disabled = false;
                    predictBtn.classList.remove('opacity-70', 'cursor-not-allowed');
                }
            }
        }
    </script>
</body>
</html>
